#!/bin/bash
#
#  Copyright 2015 VMware, Inc.
#
#  Licensed under the Apache License, Version 2.0 (the "License");
#  you may not use this file except in compliance with the License.
#  You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
#  limitations under the License.
#
# Arguments:
# 
# $3: inventory file to use for the play
# $4: playbook (YAML) file
# $5: tags

build_inventory="${1}"
inventory_template="${2}"
inventory="${3}"
playbook="${4}"
tags="${5}"

b build_inventory
t inventory_template
i inventory_file
p playbook
t tags

while getopts bt:i:p:t: opt;do
	case $opt in
		b) 	build_inventory=true
			;;
		t)	inventory_template=$OPTARG
			;;
		i) 	inventory_file=$OPTARG
			;;
		p)	playbook=$OPTARG
			;;
		t)	tags=$OPTARG


cd /opt/{{ django_app }}-ansible/playbooks/{{ django_app }}
python /opt/{{ django_app }}/prepare_kubernetes_targets.py
echo "------------------------------------------------------------------------"
echo "Running: ansible-playbook -i $inventory -{{ ansible_log_level }} $playbook --tags $tags"
echo "------------------------------------------------------------------------"
ansible-playbook -i "$inventory" -{{ ansible_log_level }} "$playbook" --tags "$tags"
